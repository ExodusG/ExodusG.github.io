---
import BaseLayout from "../layouts/BaseLayout.astro";
import MovieCard from "../components/MovieCard.astro";
import AlbumCard from "../components/AlbumCard.astro";

const baseURL = new URL(Astro.request.url).origin;

const res = await fetch(baseURL+'/api/letterboxd.json');
 var movies : any;
  var artists : any;
if(await res.status == 200){
  movies = await res.json();
  movies=movies.slice(0,15);
  const resLAstFm = await fetch(baseURL+'/api/lastfm.json');
  artists = await resLAstFm.json();
}
---

<BaseLayout title = "hobby" sideBarActiveItemID="hobby">
  <div>
    <div class="text-3xl w-full font-bold mb-5">Hobby</div>
  </div>
  <div class="mb-10 text-justify">
    J’ai différentes passions en dehors de l’informatique, notamment la musique et le cinéma. Voici donc quelques films que j’ai vus récemment ainsi que mon top albums.
  </div>
  <div class="grid grid-cols-1 sm:grid-cols-4 gap-6 items-stretch">
{movies && movies.map(movie => (
  <MovieCard
    title={movie.title}
    img={movie.image}
    url={movie.link}
    year={movie.year}
    rating={movie.rating}
    dateWatch={movie.watchedDate}
  />
))}
  </div>
    <div class="mb-5">
    <div class="text-3xl w-full font-bold">Top album</div>
  </div>
  <div class="grid grid-cols-6 sm:grid-cols-7 gap-5 items-stretch">
 {artists && artists.topalbum?.album && artists.topalbum.album.map(artist => (
  <AlbumCard
    title={artist.name}
    artist={artist.artist}
    img={artist.image["#text"]}
  />
))}
  </div>
  </BaseLayout>